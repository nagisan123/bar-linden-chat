wcchatx.MAX_SLEEP=30000;wcchatx.MAX_ERROR=5;wcchatx.MAX_RETRY=3;wcchatx.MAX_CONT_ERROR=5;wcchatx.TIMEOUT=1000*60*5;wcchatx.COLOR_DISCONNECT="#666666";wcchatx.COLOR_SLEEP="#e0e0e0";wcchatx.COLOR_STATE1="#3333cc";wcchatx.COLOR_STATE2="#66ffff";wcchatx.COLOR_STATE3="#9933ff";wcchatx.COLOR_STATE4="#330099";wcchatx.COLOR_ERROR="#ff3333";wcchatx.COLOR_SUSPENDED="#ffff66";wcchatx.COOKIE_DATE=30;wcchatx.MIN_ROWS=10;wcchatx.MAX_ROWS=999;wcchatx.SESS_COOKIE_PREFIX="sc_";wcchatx.LINE_SEPARATOR="\r\n";wcchatx.TWITTER_JS_ID="twitter_widget_js";function $GE(a){return document.getElementById(a)}function wcchatx(g,h,j,d,i,c,b){this.conf=g;this.roomdef=j;this.pollReq=null;this.sendReq=null;this.v="";this.errorCount=0;this.sleep=1000;this.order="desc";this.maxRows=100;this.dummyIFrameId="dmy";this.sts=false;this.cp=h;this.cookie=false;this.sound=false;this.noThumbnail=false;this.ignoreFontSize=false;this.multiLine=false;this.curUsers=new Object();this.seqno=0;this.updateConfigCb=null;this.viewFontSize=this.conf.enableFontSizeSel?"100":null;this.viewStyle=this.conf.iconmode?0:this.conf.fixedViewStyle>0?this.conf.fixedViewStyle:this.conf.defaultViewStyle;this.color=null;this.cookiePath="/";this.startedUp=false;this.buildFunc=this.conf.iconmode?this.buildIconData:this.buildData;this.focus=false;this.top=this.cp+"/"+(d&&d.length>0?"?theme="+d:"");this.ie2000=WCUtils._ie&&navigator.userAgent.indexOf("NT 5.0")!=-1;var a=WCUtils.getIEVersion();this.ie8_later=a>=8;this.ie9_later=a>=9;this.ie10_later=a>=10;this.netscape=navigator.userAgent.indexOf("Netscape")!=-1;this.serverLogUrl=i;this.progId=null;this.lastError=null;this.gecko=WCUtils._gecko;this.forceLang=null;this.suspended=false;this.updateTag=false;this.adTimeout=c;this.maintenance=false;this.scrollType=1;this.chrome=navigator.userAgent.indexOf("Chrome/")!=-1;this.noTextEffect=false;try{this.spry=typeof(Spry)!="undefined"&&typeof(Spry.Effect)!="undefined"}catch(f){this.spry=false}this.setSpryOption(300,null,"#ffffd5");this.timeoutTid=null;this.aborted=false}function _wcchatx_init(a){if(a){this.setupLog()}this.restore();if(this.order=="asc"){this.switchLayout(1)}this.setForm(0);if(WCUtils._safari||WCUtils._ie){setTimeout(this.timerFunc(this),WCUtils._ie?0:200)}else{this.onLoad(null)}this.chkVisibility();wcchatx.refreshAd();if(this.adTimeout>0){this.refreshAdCB(null)}}wcchatx.prototype.init=_wcchatx_init;function _wcchatx_setSpryOption(b,a,e){var c=function(g,d){g.style.backgroundColor=""};var f=b?b:500;this.spryHighlightOption=a?{duration:f,from:a,to:e,finish:c}:{duration:f,to:e,finish:c}}wcchatx.prototype.setSpryOption=_wcchatx_setSpryOption;function _wcchatx_highlight(a){if(this.spry){new Spry.Effect.Highlight(a.id,this.spryHighlightOption).start()}}wcchatx.prototype.highlight=_wcchatx_highlight;function _wcchatx_isAdjust(){return this.ie8_later||!WCUtils._ie}wcchatx.prototype.isAdjust=_wcchatx_isAdjust;function _wcchatx_switchLayout(h){var c=$GE("adcontainer1");var a=$GE("adcontainer2");var g=$GE("formcontainer1");var f=$GE("formcontainer2");var d=$GE("ad");var b=$GE("forms");var e=$GE("ctrl");if(h==0){g.appendChild(f.removeChild(b));a.appendChild(c.removeChild(d));g.style.display="block";a.style.display="block";f.style.display="none";c.style.display="none";e.style.position="static"}else{f.appendChild(g.removeChild(b));c.appendChild(a.removeChild(d));f.style.display="block";c.style.display="block";g.style.display="none";a.style.display="none";e.style.position="relative"}this.chkVisibility()}wcchatx.prototype.switchLayout=_wcchatx_switchLayout;function _wcchatx_chkVisibility(){var g="display:block !important; visibility:visible !important";if(this.order=="asc"){var b=$GE("adcontainer1");if(WCUtils._ie){b.style.cssText=g}else{b.setAttribute("style",g)}}else{var a=$GE("adcontainer2");if(WCUtils._ie){a.style.cssText=g}else{a.setAttribute("style",g)}}var d=["ad","adbody"];for(var c=0;c<d.length;c++){var f=$GE(d[c]);if(WCUtils._ie){f.style.cssText=g}else{f.setAttribute("style",g)}}}wcchatx.prototype.chkVisibility=_wcchatx_chkVisibility;function _wcchatx_getMsg(a){return this.conf.messages[a]}wcchatx.prototype.getMsg=_wcchatx_getMsg;function _wcchatx_getTag(a){return this.conf.tags[a]}wcchatx.prototype.getTag=_wcchatx_getTag;function _wcchatx_destroy(){if(this.pollReq){if(!WCUtils._ie5){try{this.pollReq.onreadystatechange=function(){};this.pollReq.abort()}catch(a){}}this.pollReq=null}}wcchatx.prototype.destroy=_wcchatx_destroy;function _wcchatx_setupLog(){if(typeof log4javascript!="undefined"){try{this.log=log4javascript.getLogger();var a=new log4javascript.PopUpAppender();a.setNewestMessageAtTop(true);this.log.addAppender(a);this.log.debug("start!!")}catch(b){}}}wcchatx.prototype.setupLog=_wcchatx_setupLog;function _wcchatx_debuglog(a){if(this.log){this.log.debug(a)}}wcchatx.prototype.debuglog=_wcchatx_debuglog;function _wcchatx_writeDummyFrame(a){document.write('<iframe onload="'+a+'.onFrameLoad(this);" id="dmy" name="dmy" style="width:0px;height:0px;margin-left:-1000px;margin-top:-1000px;"></iframe>')}wcchatx.prototype.writeDummyFrame=_wcchatx_writeDummyFrame;function _wcchatx_updateStatus(a,b){var c=$GE("status");if(c){c.style.backgroundColor=this.suspended?wcchatx.COLOR_SUSPENDED:a;c.title=b?b:""}}wcchatx.prototype.updateStatus=_wcchatx_updateStatus;function _wcchatx_getReq(){if(window.XMLHttpRequest){return new XMLHttpRequest()}else{if(window.ActiveXObject){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"];var c=null;for(var b=0;b<a.length;b++){try{c=new ActiveXObject(a[b]);this.progId=a[b];return c}catch(d){}}}}return null}wcchatx.prototype.getReq=_wcchatx_getReq;function _wcchatx_longPoll(){this.debuglog("longPoll start");this.pollReq=this.setupReq(this.pollReq,this._onStateChanged(this));if(window.opera){this.updateStatus(wcchatx.COLOR_STATE1,"state:0")}else{this.updateStatus(wcchatx.COLOR_DISCONNECT,"disconnected")}if(this.chrome){this.pollReq.open("GET",this.cp+"/comet/poll?v="+this.v+"&d="+new Date().getTime(),true)}else{this.pollReq.open("GET",this.cp+"/comet/poll?v="+this.v,true)}if(this.forceLang){this.pollReq.setRequestHeader("Accept-Language",this.forceLang)}if(this.timeoutTid){clearTimeout(this.timeoutTid);this.timeoutTid=null}this.aborted=false;this.pollReq.send(null);this.timeoutTid=setTimeout(this.timeoutFunc(this),wcchatx.TIMEOUT)}wcchatx.prototype.longPoll=_wcchatx_longPoll;function _wcchatx_setupReq(a,c){if(!a){a=this.getReq()}else{if(WCUtils._ie5||this.progId=="Msxml2.XMLHTTP.3.0"){a=this.getReq()}else{if(this.gecko&&navigator.productSub<20051111){a.onreadystatechange=null;a=this.getReq()}else{if(this.gecko){a.onreadystatechange=function(){}}try{a.abort()}catch(b){}a=this.getReq()}}}if(window.opera){a.onload=c}else{a.onreadystatechange=c}return a}wcchatx.prototype.setupReq=_wcchatx_setupReq;function _wcchatx_onStateChanged(){this.debuglog("readyState="+this.pollReq.readyState);if(this.pollReq.readyState==1){this.updateStatus(wcchatx.COLOR_STATE1,"state:1")}else{if(this.pollReq.readyState==2){this.updateStatus(wcchatx.COLOR_STATE2,"state:2")}else{if(this.pollReq.readyState==3){this.updateStatus(wcchatx.COLOR_STATE3,"state:3")}else{if(this.pollReq.readyState==4){if(this.timeoutTid){clearTimeout(this.timeoutTid);this.timeoutTid=null}if(this.aborted){this.errorHandler("timedOut");return}if(!this.gecko&&this.pollReq.status==0){this.debuglog("gecko="+this.gecko+" status="+this.pollReq.status+" text="+this.pollReq.responseText);this.errorHandler2("connection failed.")}else{this.updateStatus(wcchatx.COLOR_STATE4,"state:4");if(this.pollReq.responseText&&this.pollReq.responseText.length>0&&this.pollReq.status==200){this.onLoad(this.pollReq.responseText)}else{var b;try{b=this.pollReq.status}catch(a){b=666}if(this.gecko&&b==0){this.errorHandler2("connection failed (gecko).");return}if(b==504||b==12002||b==0){this.lastError="http:"+b;this.onLoad('{"type":"noop"}')}else{if(b==200||b==12152){this.lastError="http:"+b;this.onLoad('{"type":"noop"}')}else{this.errorHandler(b)}}}}}}}}}wcchatx.prototype.onStateChanged=_wcchatx_onStateChanged;function _wcchatx__onStateChanged(a){return function(){a.onStateChanged()}}wcchatx.prototype._onStateChanged=_wcchatx__onStateChanged;function _wcchatx_onLoad(s){if(this.log){this.debuglog("onLoad: s="+s)}var contError=0;while(true){if(this.maintenance){break}try{if(s!=null&&s.length!=0){var data=eval("("+s+")");if(this.processData(data)){this.setSessionErrorCount(0);if(!this.startedUp){this.startedUp=true;$GE("menu").style.visibility="visible"}this.longPoll()}}else{this.longPoll()}contError=0}catch(e){if(WCUtils._ie&&e.number==-2146697208&&!this.forceLang){this.forceLang=navigator.userLanguage?navigator.userLanguage:navigator.browserLanguage?navigator.browserLanguage:navigator.systemLanguage?navigator.systemLanguage:"ja";this.debuglog("set lang="+this.forceLang);contError++;if(contError>wcchatx.MAX_CONT_ERROR){this.fatal();return}continue}else{this.errorHandler("exception:"+e.name+" "+e.message+" "+e.lineNumber+" "+(e.number&65535)+" "+e.number+" "+e.line+" "+e.description)}}break}}wcchatx.prototype.onLoad=_wcchatx_onLoad;function _wcchatx_errorHandler(a){this.lastError=a;this.updateStatus(wcchatx.COLOR_ERROR,a);this.errorCount++;if(this.errorCount>wcchatx.MAX_ERROR){this.giveup();return}this.sleep=this.sleep*2;if(this.sleep>wcchatx.MAX_SLEEP){this.sleep=wcchatx.MAX_SLEEP}this.debuglog("error="+a+" count="+this.errorCount+" sleep="+this.sleep);this.serverLog(a);setTimeout(this.timerFunc(this),this.sleep);this.updateStatus(wcchatx.COLOR_SLEEP,"sleep")}wcchatx.prototype.errorHandler=_wcchatx_errorHandler;function _wcchatx_errorHandler2(a){this.lastError=a;this.updateStatus(wcchatx.COLOR_ERROR,a);this.errorCount++;if(this.errorCount>wcchatx.MAX_ERROR){this.giveup();return}this.updateStatus(wcchatx.COLOR_ERROR,"4-0 ???");setTimeout(this.timerFunc2(this),5000);this.updateStatus(wcchatx.COLOR_SLEEP,"sleep")}wcchatx.prototype.errorHandler2=_wcchatx_errorHandler2;function _wcchatx_serverLog(c){try{if(!this.serverLogUrl||this.serverLogUrl.length==0){return}var b=$GE("svlogImg");if(b){var a=this.serverLogUrl+"?msg="+encodeURIComponent(c)+"&p="+encodeURIComponent(this.progId);b.src=a}}catch(b){}}wcchatx.prototype.serverLog=_wcchatx_serverLog;function _wcchatx_timerFunc(a){return function(){a.onLoad(null)}}wcchatx.prototype.timerFunc=_wcchatx_timerFunc;function _wcchatx_timerFunc2(a){return function(){a.onLoad('{"type":"noop"}')}}wcchatx.prototype.timerFunc2=_wcchatx_timerFunc2;function _wcchatx_timeoutFunc(a){return function(){a.timedOut()}}wcchatx.prototype.timeoutFunc=_wcchatx_timeoutFunc;function _wcchatx_timedOut(){this.debuglog("timeout");if(this.pollReq){this.aborted=true;this.pollReq.abort()}}wcchatx.prototype.timedOut=_wcchatx_timedOut;function _wcchatx_setLogorder(c){if(c=="desc"&&(!this.order||this.order=="desc")){return}else{if(c=="asc"&&this.order=="asc"){return}}var a=$GE("content");if(c=="asc"){var d=a.firstChild;while(d){var b=d.nextSibling;if(!b){break}a.removeChild(b);a.insertBefore(b,a.firstChild)}}else{var d=a.lastChild;while(d){var b=d.previousSibling;if(!b){break}a.removeChild(b);a.appendChild(b)}}this.order=c;this.switchLayout(c=="asc"?1:0);if(this.isAdjust()){this.adjust()}this.scroll()}wcchatx.prototype.setLogorder=_wcchatx_setLogorder;function _wcchatx_processData(h){if(h.type=="abort"){this.abort();return false}if(h.type=="fatal"){this.fatal();return false}if(h.type=="error"){this.error();return false}if(h.type=="reload"){this.reload(false);return false}if(h.type=="forceReload"){this.reload(true);return false}if(h.type=="noop"){return true}if(h.type=="redirect"){var q=h.sleep?h.sleep:0;setTimeout(function(){top.location.href=h.url},q);return false}if(h.type=="maintenance"){WCModal.modal(this.getTag("msg.tag.maintenance"));this.maintenance=true;mnt.start(h.sec,this.top);return false}if(this.suspended){if(h.v){this.v=h.v}return}var j=$GE("content");var p=this.seqno;var m=!this.order||this.order=="desc";var d=this.sound?new Array():null;var a=0;var b=h.type=="replace";if(b||h.type=="hide"){this.debuglog("replace");while(j.hasChildNodes()){j.removeChild(j.firstChild)}p=0}if(h.type=="hide"){if($GE("hideLog").style.display=="none"){$GE("hideLog").style.display="block"}}else{if($GE("hideLog").style.display=="block"){$GE("hideLog").style.display="none"}}if(p!=0&&h.logs&&h.logs.length>0){var g=false;for(var f=0,c=h.logs.length;f<c;f++){var e=h.logs[f];if(e.type=="info"){if(e.infoType=="clear"){if(this.clearCommand(e.data)){g=true}}else{if(e.infoType=="undo"){if(this.undoCommand(e.data)){g=true}}else{if(e.infoType=="clearByName"){if(this.clearByNameCommand(e.data)){g=true}}else{if(e.infoType=="clearTweets"){if(this.clearTweets()){g=true}}}}}}}if(g){this.updateClass()}}var s=m?j.firstChild:j.lastChild;var r=s?s.className.indexOf("logodd")!=-1?"odd":"even":"odd";var l=false;if(h.logs&&h.logs.length>0){for(var f=0,c=h.logs.length;f<c;f++){var e=h.logs[f];if(e.seqno<p){continue}if(e.type=="info"&&e.infoType=="tweet"){l=true}if(d&&e.type=="info"&&this.seqno!=0&&this.seqno<e.seqno){if(e.infoType=="enter"){d[d.length]="enter"}else{if(e.infoType=="exit"){d[d.length]="exit"}else{if(e.infoType=="disappear"){d[d.length]="disappear"}else{if(e.infoType=="bell"){d[d.length]="bell"}else{if(e.infoType=="autoExit"){d[d.length]="disappear"}else{if(e.infoType=="tweet"){d[d.length]="send"}}}}}}}else{if(d&&e.type=="msg"&&this.seqno!=0&&this.seqno<e.seqno){d[d.length]="send"}}if(a<e.seqno){a=e.seqno}var k=r=="odd"?"even":"odd";var o=this.buildFunc(e,k,h.logs.length==(f+1));if(!o){continue}r=k;if(m){j.insertBefore(o,j.firstChild)}else{j.appendChild(o)}if(!b&&this.conf.enableTextEffect&&!this.noTextEffect){this.highlight(o)}}var c=j.childNodes.length;if(c>this.maxRows){for(var f=0;f<(c-this.maxRows);f++){j.removeChild(m?j.lastChild:j.firstChild)}}if(this.isScroll()){this.scroll()}}this.seqno=h.type=="hide"?0:this.seqno<a?a:this.seqno;if(h.v){this.v=h.v}this.setStatus(h.sts);this.setUsers(h);this.setInformation(h.information);if(l){this.tweet(wcchatx.TWITTER_JS_ID)}if(d){this.playSound(d)}return true}wcchatx.prototype.processData=_wcchatx_processData;function _wcchatx_clearCommand(a){var b="eid_"+a+"_";var f=$GE("content");var c=f.firstChild;var e=false;while(c){var d=c;c=c.nextSibling;if(d.id&&WCUtils.startsWith(d.id,b)){f.removeChild(d);e=true}}return e}wcchatx.prototype.clearCommand=_wcchatx_clearCommand;function _wcchatx_clearByNameCommand(c){var f=$GE("content");var d=f.firstChild;var e=false;while(d){var g=d;d=d.nextSibling;if(g.id){var i=g.id.split("_");if(i.length!=4||i[0]!="eid"){continue}var b="uname_"+i[3];var a=$GE(b);if(a){var h=a.firstChild;if(h&&h.nodeType==3){if(h.nodeValue==c){f.removeChild(g);e=true}}}}}}wcchatx.prototype.clearByNameCommand=_wcchatx_clearByNameCommand;function _wcchatx_clearTweets(){var d=$GE("content");var a=d.firstChild;var c=false;while(a){var b=a;a=a.nextSibling;if(b.id&&WCUtils.startsWith(b.id,"tweet_")){d.removeChild(b);c=true}}return c}wcchatx.prototype.clearTweets=_wcchatx_clearTweets;function _wcchatx_undoCommand(f){var c="_"+f;var e=$GE("content");var b=e.childNodes;for(var a=0,d=b.length;a<d;a++){if(b[a].id&&WCUtils.endsWith(b[a].id,c)){e.removeChild(b[a]);return true}}return false}wcchatx.prototype.undoCommand=_wcchatx_undoCommand;function _wcchatx_updateClass(){var b=$GE("content").childNodes;for(var a=0,c=b.length;a<c;a++){if((a%2)!=0){b[a].className=b[a].className.replace("logeven","logodd")}else{b[a].className=b[a].className.replace("logodd","logeven")}}}wcchatx.prototype.updateClass=_wcchatx_updateClass;function _wcchatx_scroll(){var a=!this.order||this.order=="desc";if(a){$GE("contentWrap").scrollTop=0}else{wcchatx.__scroll(null)}}wcchatx.prototype.scroll=_wcchatx_scroll;function _wcchatx_isScroll(){if(!this.conf.enableScrollType){return true}if(this.scrollType==0){return false}else{if(this.scrollType==1){return true}}var a=$GE("contentWrap");if(!a){return false}var b=!this.order||this.order=="desc";if(b){if(a.scrollTop==0){return true}}else{if(a.offsetHeight>=a.scrollHeight){return true}else{if(a.scrollTop>=(a.scrollHeight-a.offsetHeight)){return true}}}return false}wcchatx.prototype.isScroll=_wcchatx_isScroll;function _wcchatx_setUsers(c){var b=c.count;var g=c.users;var f;if(typeof b!="undefined"){$GE("cond").style.visibility=(b.users==null&&b.roms==null)?"hidden":"visible";$GE("condUser").style.display=b.users==null?"none":"inline";$GE("condRom").style.display=b.roms==null?"none":"inline";if(b.users!=null){$GE("in").innerHTML=b.users}if(b.roms!=null){$GE("rom").innerHTML=b.roms}}if(typeof g!="undefined"){f=$GE("users");if(g==null||g.length==0){f.innerHTML="&nbsp;"}else{var d="&nbsp;(";for(var a=0,e=g.length;a<e;a++){d+=(a!=0?", ":"");d+='<a href="javascript:void(0)" onclick="return chatx.showUserInfo(event, \''+g[a].eid+"');\">"+g[a].name+"</a>"}d+=")&nbsp;";f.innerHTML=d}this.updatePmSelect(g);this.updateUsersMap(g);if(this.isAdjust()){this.adjust()}}else{if(typeof c.pmSel!="undefined"){this.updatePmSelect(c.pmSel);if(this.gecko){this.adjust()}}}}wcchatx.prototype.setUsers=_wcchatx_setUsers;function _wcchatx_updateUsersMap(c){this.curUsers=new Object();if(!c){return}for(var a=0,b=c.length;a<b;a++){this.curUsers[c[a].eid]=c[a]}}wcchatx.prototype.updateUsersMap=_wcchatx_updateUsersMap;function _wcchatx_showUserInfo(c,a){var b=this.curUsers[a];if(!b){alert("not found!!");return}$GE("userinfoName").innerHTML=b.name;var d;if((d=$GE("userinfoUrl"))){if(b.url){$GE("uiUrlDt").style.display="block";$GE("uiUrlDd").style.display="block";d.innerHTML='<a target="_blank" title="'+b.url+'" href="'+(b.linkUrl?b.linkUrl:b.url)+'">'+b.url+"</a>"}else{$GE("uiUrlDt").style.display="none";$GE("uiUrlDd").style.display="none"}}if((d=$GE("userinfoDenyPm"))){if(typeof b.denyPm=="undefined"){$GE("uiPmDt").style.display="none";$GE("uiPmDd").style.display="none"}else{$GE("uiPmDt").style.display="block";$GE("uiPmDd").style.display="block";d.innerHTML=this.getMsg(b.denyPm?"msg.c.pmDeny":"msg.c.pmAllow")}}if((d=$GE("userinfoComment"))){if(b.comment){$GE("uiCmtDt").style.display="block";$GE("uiCmtDd").style.display="block";d.innerHTML=b.comment}else{$GE("uiCmtDt").style.display="none";$GE("uiCmtDd").style.display="none"}}if((d=$GE("userinfoHost"))){if(b.rh){$GE("uiHostDt").style.display="block";$GE("uiHostDd").style.display="block";d.innerHTML=b.rh}else{$GE("uiHostDt").style.display="none";$GE("uiHostDd").style.display="none"}}if((d=$GE("userinfoIp"))){if(b.ra){$GE("uiIpDt").style.display="block";$GE("uiIpDd").style.display="block";d.innerHTML=b.ra}else{$GE("uiIpDt").style.display="none";$GE("uiIpDd").style.display="none"}}if((d=$GE("userinfoTerm"))){if(b.term){$GE("uiTermDt").style.display="block";$GE("uiTermDd").style.display="block";d.innerHTML=b.term}else{$GE("uiTermDt").style.display="none";$GE("uiTermDd").style.display="none"}}if((d=$GE("userinfoId"))){if(b.id2ch){$GE("uiIdDt").style.display="block";$GE("uiIdDd").style.display="block";d.innerHTML=b.id2ch}else{$GE("uiIdDt").style.display="none";$GE("uiIdDd").style.display="none"}}if((d=$GE("uiIcon"))){if(b.icon){d.src=b.icon;d.style.display="inline"}else{d.style.display="none"}}WCUtils.showPopup2(c,"userinfo",true);return false}wcchatx.prototype.showUserInfo=_wcchatx_showUserInfo;function _wcchatx_giveup(){if(this.incSessionErrorCount()>wcchatx.MAX_RETRY){alert("give up!");var a=this.cp+"/c/fatal.jsp?e="+encodeURIComponent(this.lastError)+"&p="+encodeURIComponent(this.progId);window.location.href=a}else{this.reload(false)}}wcchatx.prototype.giveup=_wcchatx_giveup;function _wcchatx_error(){this.errorHandler("error")}wcchatx.prototype.error=_wcchatx_error;function _wcchatx_abort(){this.reload(false)}wcchatx.prototype.abort=_wcchatx_abort;function _wcchatx_fatal(){this.destroy();window.location.href=this.cp+"/c/fatal.jsp"}wcchatx.prototype.fatal=_wcchatx_fatal;function _wcchatx_reload(a){this.destroy();if(this.roomdef.chattop){window.location.href=this.roomdef.chattop+"c/reload.jsp"+(a?"?force":"")}else{if(a){window.location.reload(true)}else{window.location.href=this.top}}}wcchatx.prototype.reload=_wcchatx_reload;function _wcchatx_setForm(f){var d=$GE("ctrl");var c=$GE("contentWrap");var b=$GE("container");var a=$GE("ad");d.style.height="auto";var e;if(f==2){if((e=$GE("entf"))){e.style.display="none"}$GE("sndf").style.display="block";if(this.multiLine){$GE("msgDmy").style.display="none";$GE("mmsgDmy").style.display="inline";$GE("mmsgDmy").focus()}else{$GE("msgDmy").style.display="inline";var e;if((e=$GE("mmsgDmy"))){e.style.display="none"}$GE("msgDmy").focus()}$GE("userhtml").style.display="none";if((e=$GE("enter"))){e.style.display="none"}$GE("exit").style.display="inline";this.setError(null);this.updateIconGroup()}else{f=this.conf.fixedEnterForm?1:f;$GE("sndf").style.display="none";$GE("exit").style.display="none";if(this.conf.mixiAuth||this.conf.hatenaAuth){$GE("enter").style.display="inline";$GE("userhtml").style.display="block"}else{if(!this.conf.fixedEnterForm){$GE("enterAnc").innerHTML=this.getMsg(f==1?"msg.c.cancel":"msg.c.enter");$GE("enter").style.display="inline";$GE("userhtml").style.display=f==1?"none":"block"}else{$GE("userhtml").style.display="block"}}if((e=$GE("entf"))){e.style.display=f==1?"block":"none"}if((e=$GE("entCookie"))){e.checked=this.cookie}if(f==1){if($GE("name")){$GE("name").focus();$GE("name").select()}this.setError(null)}}if(this.isAdjust()){this.adjust()}}wcchatx.prototype.setForm=_wcchatx_setForm;function _wcchatx_adjust(){var c=WCUtils.getEmpx2("container");if(this.order=="asc"){var f=$GE("ctrl");var e=$GE("contentWrap");var d=$GE("ctrl2");var b=$GE("ad");var g=((f.scrollHeight+b.scrollHeight)/c)+"em";var a=(d.scrollHeight/c)+"em";e.style.top=g;e.style.bottom=a}else{var f=$GE("ctrl");var e=$GE("contentWrap");var b=$GE("ad");f.style.height="auto";if(this.gecko){f.style.height=f.scrollHeight+"px";e.style.top=f.scrollHeight+"px"}else{var g=(f.scrollHeight/c)+"em";f.style.height=g;e.style.top=g}e.style.bottom=b.scrollHeight+"px"}}wcchatx.prototype.adjust=_wcchatx_adjust;function _wcchatx_setIcon(a){if(!this.conf.iconmode){return}var c=$GE("icon");if(!c){return}var b=a?a:c.value;if(!b||!this.validateIconUrl(b)||b==this.conf.icons[0].value){$GE("icon").value="";$GE("curIcon").src=(this.roomdef.icon?this.roomdef.icon:"")+this.conf.icons[0].value}else{$GE("icon").value=b;$GE("curIcon").src=(this.roomdef.icon?this.roomdef.icon:"")+b}}wcchatx.prototype.setIcon=_wcchatx_setIcon;function _wcchatx_setIconGroup(a){var d=$GE("curIconGroup");var c=$GE("giconDmy");if(!d||!c){return}var b=$GE("icon");if(!b||!b.value){return}if(b.value==a){a=null}if(!a){c.value="";d.src=(this.roomdef.icon?this.roomdef.icon:"")+b.value}else{c.value=a;d.src=(this.roomdef.icon?this.roomdef.icon:"")+a}}wcchatx.prototype.setIconGroup=_wcchatx_setIconGroup;function _wcchatx_setIconGroupPicker(a){this.iconGroupPicker=a}wcchatx.prototype.setIconGroupPicker=_wcchatx_setIconGroupPicker;function _wcchatx_updateIconGroup(){var e=$GE("giconSpan");var c=$GE("giconDmy");if(!e||!c){return}if(!this.conf.iconmode||!this.conf.iconGroup){e.style.display="none";c.value="";return}if(!this.iconGroupPicker){e.style.display="none";c.value="";return}var b=$GE("icon");if(!b){e.style.display="none";c.value="";return}var a=b.value;if(!a||!this.validateIconUrl(a)||a==this.conf.icons[0].value){e.style.display="none";c.value="";return}if(!iconGroup){e.style.display="none";c.value="";return}var d=iconGroup[a];if(!d||d.length==0){e.style.display="none";c.value="";return}e.style.display="inline";this.iconGroupPicker.reset(d,true);c.value=d[0].value;this.setIconGroup(null)}wcchatx.prototype.updateIconGroup=_wcchatx_updateIconGroup;function _wcchatx_setStatus(a){if(a!=null){if(this.sts!=a){this.sts=a;this.setForm(this.sts?2:0);if(this.sts){var b=document.getElementById("nkfrm");if(b){b.src="/c/_nk.jsp?p=enter"}}}}}wcchatx.prototype.setStatus=_wcchatx_setStatus;function _wcchatx_setInformation(a){if(a==null){return}if(a.msg&&a.msg.length>0){$GE("infoMsg").innerHTML=a.msg;$GE("information").style.display="inline"}else{$GE("information").style.display="none"}if(a.icon&&a.icon.length>0){$GE("informationAnch").className=a.icon}else{$GE("informationAnch").className="infIcon1"}}wcchatx.prototype.setInformation=_wcchatx_setInformation;function _wcchatx_cb(a){this.debuglog("callback: result="+a.result+" sts="+a.sts+" err="+a.err);this.setStatus(a.sts);this.setError(a.err);var b=$GE("etm");if(b){b.value=""}if(a.result){$GE("msgDmy").value="";var c=$GE("mmsgDmy");if(c){c.value=""}}this.reset();$GE("msg").value="";this.updateAttach();this.focusInput();if(a.nk){var c=document.getElementById("nkfrm");if(c){c.src="/c/_nk.jsp?p=cb"}}}wcchatx.prototype.cb=_wcchatx_cb;function _wcchatx_onFrameLoad(a){this.debuglog("onFrameLoad");var b=$GE("msg");if(b&&b.value!=""){if(a.contentWindow.dos||a.contentWindow.black){this.abort();return}if(!a.contentWindow.dmy){this.setError(this.getMsg("msg.c.err.unknownError"))}this.reset();b.value="";this.focusInput()}}wcchatx.prototype.onFrameLoad=_wcchatx_onFrameLoad;function _wcchatx_focusInput(){var a=$GE("sndf");if(a.style.display=="none"){return}if(this.multiLine){$GE("mmsgDmy").focus()}else{$GE("msgDmy").focus()}}wcchatx.prototype.focusInput=_wcchatx_focusInput;function _wcchatx_setError(a){var b=$GE(this.sts?"err2":"err");if(!b){return}if(a&&a.length>0){b.innerHTML='<span class="err">'+a+"</span>"}else{b.innerHTML=""}}wcchatx.prototype.setError=_wcchatx_setError;function _wcchatx_toggleForm(){if(!$GE("entf")){return false}this.setForm($GE("entf").style.display!="block"?1:0);this.scroll();return false}wcchatx.prototype.toggleForm=_wcchatx_toggleForm;function _wcchatx_enter(){var b=WCUtils.trim($GE("name").value);if(b.length==0){this.setError(this.getMsg("msg.c.err.name"));$GE("name").focus();return false}var c=$GE("etm");if(c){var d=new Date().getTime();if(c.value!=""){var a=c.value;if((d-a)<5000){return false}}c.value=d}c=$GE("plaf");if(c){c.value=wcchatx.getPlaf()}this.cookie=$GE("entCookie").checked;this.save(false,true);this.updatePmSelect(null);return true}wcchatx.prototype.enter=_wcchatx_enter;function _wcchatx_send(){this.debuglog("send start.");var f=new Date().getTime();try{this.setError(null);var g=this.multiLine?$GE("mmsgDmy"):$GE("msgDmy");var b;var c=(b=$GE("attach"))&&b.value!="";if(WCUtils.trimx(g.value).length==0&&!c){return false}if($GE("msg").value!=""){var a=$GE("tm").value;if(a){if((f-a)<1500){return false}}if((f-a)<5000){this.setError(this.getMsg("msg.c.err.busy"));return false}}$GE("tm").value=f;$GE("cb").value="parent.chatx.cb";$GE("msg").value=g.value;if((g=$GE("pmDmy"))){$GE("pm").value=g.value}if((g=$GE("colorDmy"))){$GE("color").value=g.value}if((g=$GE("fontSizeDmy"))){$GE("fontSize").value=g.value}if((g=$GE("giconDmy"))){$GE("gicon").value=g.value}$GE("sendform").submit()}catch(d){this.setError(d+"");$GE("msg").value="";this.reset();this.updateAttach()}return false}wcchatx.prototype.send=_wcchatx_send;function _wcchatx_updatePmSelect(a){var f=$GE("pmDmy");if(!f){return}var h=f.value;for(var d=0,c=f.options.length;d<c;d++){f.options[d]=null}f.options.length=0;var g=false;var j=0;var b=0;f.options[j++]=new Option("","");if(a!=null){for(var d=0,c=a.length;d<c;d++){if(a[d].denyPm){continue}var e=new Option(WCUtils.unescapeHTML(a[d].name),a[d].eid);if(e.value==h){b=j}f.options[j++]=e;g=true}}if(g&&this.conf.enablePmAll){var e=new Option(this.getMsg("msg.c.pmAll"),"all");if(h=="all"){b=j}f.options[j]=e}if(window.opera){setTimeout(function(){$GE("pmDmy").options[b].selected=true},0)}else{$GE("pmDmy").options[b].selected=true}}wcchatx.prototype.updatePmSelect=_wcchatx_updatePmSelect;function _wcchatx_save(a,b){var c=this.cookie?wcchatx.COOKIE_DATE:-1;var e=this.cookie?"":wcchatx.SESS_COOKIE_PREFIX;var f=this.cookiePath;var d=this.roomdef.cookieDomain;if(a){WCUtils.addCookie2(e+"sound",this.sound?"true":"false",c,f,d);WCUtils.addCookie2(e+"logorder",this.order,c,f,d);WCUtils.addCookie2(e+"maxRows",this.maxRows,c,f,d);WCUtils.addCookie2(e+"setFocus",this.focus,c,f,d);WCUtils.addCookie2(e+"updateTag",this.updateTag,c,f,d);WCUtils.addCookie2(e+"multiLine",this.multiLine?"true":"false",c,f,d);if(!this.conf.iconmode&&this.conf.fixedViewStyle<=0){WCUtils.addCookie2(e+"viewStyle",this.viewStyle+"",c,f,d)}WCUtils.addCookie2(e+"viewFontSize",this.viewFontSize?this.viewFontSize:"",c,f,d);WCUtils.addCookie2(e+"noThumbnail",this.noThumbnail?"true":"false",c,f,d);WCUtils.addCookie2(e+"ignoreFontSize",this.ignoreFontSize?"true":"false",c,f,d);WCUtils.addCookie2(e+"noTextEffect",this.noTextEffect?"true":"false",c,f,d);if(this.conf.enableScrollType){WCUtils.addCookie2(e+"scrollType",this.scrollType,c,f,d)}}if(b){WCUtils.addCookie2(e+"name",$GE("name").value,c,f,d);var g;if((g=$GE("url"))){WCUtils.addCookie2(e+"url",g.value,c,f,d)}if((g=$GE("icon"))){WCUtils.addCookie2(e+"icon",g.value,c,f,d)}if((g=$GE("comment"))){WCUtils.addCookie2(e+"comment",g.value,c,f,d)}if((g=$GE("denyPm"))){WCUtils.addCookie2(e+"denyPm",g.checked?"true":"false",c,f,d)}}}wcchatx.prototype.save=_wcchatx_save;function _wcchatx_incSessionErrorCount(){var a=this.getSessionErrorCount();a++;WCUtils.addCookie2("errorCount",a+"",-1,this.cookiePath,this.roomdef.cookieDomain);this.debuglog("sessionErrorCount="+a);return a}wcchatx.prototype.incSessionErrorCount=_wcchatx_incSessionErrorCount;function _wcchatx_setSessionErrorCount(a){WCUtils.addCookie2("errorCount",a+"",-1,this.cookiePath,this.roomdef.cookieDomain)}wcchatx.prototype.setSessionErrorCount=_wcchatx_setSessionErrorCount;function _wcchatx_getSessionErrorCount(){var a;if((a=WCUtils.getCookie("errorCount"))){return parseInt(a)}return 0}wcchatx.prototype.getSessionErrorCount=_wcchatx_getSessionErrorCount;function _wcchatx_restore(){var a=false;var b;var d;if((b=this.getCookieVal("sound"))){this.sound=b.val=="true";a=a||b.exists}if((b=this.getCookieVal("setFocus"))){this.focus=b.val=="true";a=a||b.exists;if(!$GE("setFocus")){this.focus=false}}if((b=this.getCookieVal("updateTag"))){this.updateTag=b.val=="true";a=a||b.exists;if(!$GE("updateTag")){this.updateTag=false}}if((b=this.getCookieVal("logorder"))){this.order=b.val=="asc"?"asc":"desc";a=a||b.exists}if((b=this.getCookieVal("maxRows"))){var c=parseInt(b.val);if(c>=wcchatx.MIN_ROWS&&c<=wcchatx.MAX_ROWS){this.maxRows=c}a=a||b.exists}if((b=this.getCookieVal("multiLine"))){this.multiLine=this.conf.enableMultiLine&&b.val=="true";a=a||b.exists}if(this.conf.iconmode){this.viewStyle=0}else{if(this.conf.fixedViewStyle>0){this.viewStyle=this.conf.fixedViewStyle}else{if((b=this.getCookieVal("viewStyle"))){this.viewStyle=parseInt(b.val);if(this.viewStyle<1||this.viewStyle>3){this.viewStyle=this.conf.defaultViewStyle}a=a||b.exists}else{this.viewStyle=this.conf.defaultViewStyle}}}if((b=this.getCookieVal("viewFontSize"))){if(this.conf.enableFontSizeSel){if(b.val.match(/^[0-9]+$/)){this.viewFontSize=b.val;this.updateFontSize();a=a||b.exists}}}if(!this.conf.enableScrollType){this.scrollType=1}else{if((b=this.getCookieVal("scrollType"))){this.scrollType=parseInt(b.val);if(this.scrollType<1||this.scrollType>3){this.scrollType=1}a=a||b.exists}else{this.scrollType=1}}if((d=$GE("name"))&&(b=this.getCookieVal("name"))){$GE("name").value=b.val;a=a||b.exists}if((d=$GE("url"))&&(b=this.getCookieVal("url"))){$GE("url").value=b.val;a=a||b.exists}this.setIcon(null);if((d=$GE("icon"))&&(b=this.getCookieVal("icon"))){if(this.validateIconUrl(b.val)){$GE("icon").value=b.val;this.setIcon(b.val)}a=a||b.exists}if((d=$GE("comment"))&&(b=this.getCookieVal("comment"))){$GE("comment").value=b.val;a=a||b.exists}if((d=$GE("denyPm"))&&(b=this.getCookieVal("denyPm"))){$GE("denyPm").checked=b.val=="true";a=a||b.exists}if((d=$GE("color"))&&(b=this.getCookieVal("color"))){this.updateColor(b.val);a=a||b.exists}else{this.updateColor(null)}if((b=this.getCookieVal("noThumbnail"))){this.noThumbnail=b.val=="true";a=a||b.exists}if((b=this.getCookieVal("ignoreFontSize"))){this.ignoreFontSize=b.val=="true";a=a||b.exists}if((b=this.getCookieVal("noTextEffect"))){this.noTextEffect=b.val=="true";a=a||b.exists}this.cookie=a}wcchatx.prototype.restore=_wcchatx_restore;function _wcchatx_getCookieVal(a){var c=WCUtils.getCookie(a);var b=c!=null?true:false;if(c==null){c=WCUtils.getCookie(wcchatx.SESS_COOKIE_PREFIX+a)}if(c==null){return null}return{val:c,exists:b}}wcchatx.prototype.getCookieVal=_wcchatx_getCookieVal;function _wcchatx_validateIconUrl(a){if(!this.conf||!this.conf.icons){return false}for(var b=0;b<this.conf.icons.length;b++){if(this.conf.icons[b].value==a){return true}}return false}wcchatx.prototype.validateIconUrl=_wcchatx_validateIconUrl;function _wcchatx_updateColor(a){if(!$GE("colorDmy")){return}if(!a||!this.color){this.color=!this.conf.colors||this.conf.colors.length==0?"#000000":this.conf.colors[0].value}if(a){var d=false;for(var c=0,h=this.conf.colors.length;c<h;c++){if(a==this.conf.colors[c].value){d=true;break}}if(!d){a=this.conf.colors[0].value}if(a!=this.color){var e=this.cookie?wcchatx.COOKIE_DATE:-1;var f=this.cookie?"":wcchatx.SESS_COOKIE_PREFIX;WCUtils.addCookie2(f+"color",a,e,this.cookiePath,this.roomdef.cookieDomain)}this.color=a}$GE("colorDmy").value=this.color;var g=$GE("colorAnch");if(g){g.style.backgroundColor=this.color}else{g=$GE("selColorPicker");if(g){var b=g.options;for(var c=0,h=b.length;c<h;c++){if(b[c].value==this.color){g.selectedIndex=c;if(!window.all&&!window.opera){g.style.color=this.color}break}}}}}wcchatx.prototype.updateColor=_wcchatx_updateColor;function _wcchatx_showConfigDialog(c){var f;if((f=$GE("sound"))){f.checked=this.sound}if((f=$GE("cookie"))){f.checked=this.cookie}if((f=$GE("multiLine"))){f.checked=this.multiLine}if((f=$GE("setFocus"))){f.checked=this.focus}if((f=$GE("updateTag"))){f.checked=this.updateTag}if((f=$GE("noThumbnail"))){f.checked=this.noThumbnail}if((f=$GE("ignoreFontSize"))){f.checked=this.ignoreFontSize}if((f=$GE("noTextEffect"))){f.checked=this.noTextEffect}if((f=$GE("viewFontSize"))){var a=f.options;for(var b=0,e=a.length;b<e;b++){if(this.viewFontSize==a[b].value){a[b].selected=true;break}}}var d=$GE("viewStyle");if(d){for(var b=0,e=d.options.length;b<e;b++){if(d.options[b].value==this.viewStyle){d.selectedIndex=b;break}}}if(this.order=="asc"){$GE("logorder2").checked=true}else{$GE("logorder1").checked=true}$GE("maxRows").value=this.maxRows;WCUtils.showPopup2(c,"config",true);return false}wcchatx.prototype.showConfigDialog=_wcchatx_showConfigDialog;function _wcchatx_updateConfig(){var g;if((g=$GE("sound"))){this.sound=g.checked}else{this.sound=false}if((g=$GE("cookie"))){this.cookie=g.checked}else{this.cookie=false}if((g=$GE("setFocus"))){this.focus=g.checked}else{this.focus=false}if((g=$GE("updateTag"))){this.updateTag=g.checked}else{this.updateTag=false}if((g=$GE("noThumbnail"))){this.noThumbnail=g.checked}else{this.noThumbnail=false}if((g=$GE("ignoreFontSize"))){this.ignoreFontSize=g.checked}else{this.ignoreFontSize=false}if((g=$GE("noTextEffect"))){this.noTextEffect=g.checked}else{this.noTextEffect=false}if((g=$GE("entCookie"))){g.checked=this.cookie}var e=$GE("viewStyle");var a=null;if(e){a=e.options[e.selectedIndex].value;if(a==this.viewStyle){a=null}else{this.viewStyle=e.options[e.selectedIndex].value}}e=$GE("viewFontSize");var c=null;if(e){c=e.options[e.selectedIndex].value;if(c==this.viewFontSize){c=null}else{this.viewFontSize=e.options[e.selectedIndex].value}}e=$GE("scrollType");if(e){var b=e.options[e.selectedIndex].value;this.scrollType=b}var d=$GE("maxRows").value;if(!d.match(/^[0-9]+$/)){alert(this.getMsg("msg.c.err.maxRows"));$GE("maxRows").focus();return false}var f=parseInt(d);if(f<wcchatx.MIN_ROWS||f>wcchatx.MAX_ROWS){alert(this.getMsg("msg.c.err.maxRows"));$GE("maxRows").focus();return false}this.maxRows=f;WCUtils.hideCurrentPopup();if((g=$GE("multiLine"))&&this.conf.enableMultiLine){this.multiLine=g.checked}else{this.multiLine=false}this.setLogorder($GE("logorder2").checked?"asc":"desc");this.save(true,false);if(this.sts){this.setForm(2)}if(a){this.updateViewStyle()}if(c){this.updateFontSize()}if(this.updateConfigCb){this.updateConfigCb()}return false}wcchatx.prototype.updateConfig=_wcchatx_updateConfig;function _wcchatx_updateAttach(){var e=$GE("attach");var b=$GE("attachFname");var d="";if(e&&e.value!=""){var a="/";if(navigator.platform=="Win32"||navigator.platform=="Win64"){a="\\"}var c=e.value.lastIndexOf(a);if(c==-1){if(window.opera){d=e.value}else{d=this.getMsg("msg.c.attached")}}else{d=e.value.substring(c+1,e.value.length)}}if(b){while(b.firstChild){b.removeChild(b.firstChild)}if(d!=""){b.appendChild(document.createTextNode(d))}}}wcchatx.prototype.updateAttach=_wcchatx_updateAttach;function _wcchatx_attach(){this.updateAttach();WCUtils.hideCurrentPopup();return false}wcchatx.prototype.attach=_wcchatx_attach;function _wcchatx_sizeString(a){var c;var b;if(a>(1024*1024)){c=parseInt(a/(1024*1024)*10);b=parseInt(c/10)+"."+(c%10)+"MB"}else{if(a>1024){c=parseInt(a/1024*10);b=parseInt(c/10)+"."+(c%10)+"KB"}else{b=a+"Bytes"}}return b}wcchatx.prototype.sizeString=_wcchatx_sizeString;function _wcchatx_reset(){if(this.ie2000||this.ie10_later){var a=$GE("attachWrap");var b=$GE("attach");if(a&&b){a.removeChild(b);b=document.createElement("input");b.type="file";b.className="inpfile";b.name="attach";b.id="attach";a.appendChild(b)}}var b=$GE("sendform");if(b){b.reset()}}wcchatx.prototype.reset=_wcchatx_reset;function _wcchatx_cancelAttach(){this.reset();this.updateAttach()}wcchatx.prototype.cancelAttach=_wcchatx_cancelAttach;function _wcchatx_cancelAttachFunc(a){return function(){a.cancelAttach()}}wcchatx.prototype.cancelAttachFunc=_wcchatx_cancelAttachFunc;function _wcchatx_suspend(a){if(this.suspended&&!a){this.reload(false)}this.suspended=a;if(a){this.updateStatus(wcchatx.COLOR_SUSPENDED,"suspended")}}wcchatx.prototype.suspend=_wcchatx_suspend;function _wcchatx_playSound(c){for(var a=0,f=c.length;a<f;a++){this.debuglog("playSound:"+c[a]);var d=null;if(!this.ie9_later){d=$GE("embdsound"+c[a])}if(!d){d=$GE("sound"+c[a])}if(d){try{d.Play()}catch(b){try{d.play()}catch(b){try{d.DoPlay()}catch(b){}}}}}}wcchatx.prototype.playSound=_wcchatx_playSound;function _wcchatx_updateViewStyle(){var a="log"+this.viewStyle;var b=$GE("content").firstChild;while(b){if(b.className){b.className=b.className.replace(/^log[123]/,a)}b=b.nextSibling}}wcchatx.prototype.updateViewStyle=_wcchatx_updateViewStyle;function _wcchatx_updateFontSize(){if(!this.conf.enableFontSizeSel){return}var a=document.getElementsByTagName("body");if(a.length==1){if(this.viewFontSize&&this.viewFontSize.length>0){a[0].style.fontSize=this.viewFontSize+"%"}else{a[0].style.fontSize="100%"}}if(this.isAdjust()){this.adjust()}}wcchatx.prototype.updateFontSize=_wcchatx_updateFontSize;function _wcchatx_curUsersView(){var a=$GE("users");if(!a){return true}return a.style.display=="none"?false:true}wcchatx.prototype.curUsersView=_wcchatx_curUsersView;function _wcchatx_toggleUsersView(){this.setUsersView(this.curUsersView()?true:false);return false}wcchatx.prototype.toggleUsersView=_wcchatx_toggleUsersView;function _wcchatx_setUsersView(a){var c=$GE("users");var b=$GE("usersToggleAnch");if(!c||!b){return}if(a){c.style.display="none";b.innerHTML="&raquo;"}else{c.style.display="inline";b.innerHTML="&laquo;"}if(this.isAdjust()){this.adjust()}}wcchatx.prototype.setUsersView=_wcchatx_setUsersView;function _wcchatx_formatAttachString(c,b,a){c=c.replace(/%CT%/g,b).replace(/%SIZE%/g,a);return c}wcchatx.prototype.formatAttachString=_wcchatx_formatAttachString;function _wcchatx_buildTweetData(a,c,b){var d=document.createElement("div");d.id="tweet_"+a.seqno;d.className="log_tweet";if(false&&this.updateTag){d.innerHTML=wcchatx.processUpdateTag(a.tag)}else{d.innerHTML=a.tag}return d}wcchatx.prototype.buildTweetData=_wcchatx_buildTweetData;function _wcchatx_buildData(c,e,d){if(c.type=="info"&&(!c.tag||c.tag.length==0)){return}var f=c.type=="info"&&c.infoType=="tweet";if(f){return this.buildTweetData(c,e,d)}var g=document.createElement("div");if(c.eid){g.id="eid_"+c.eid+"_"+c.seqno}else{g.id="inf_"+c.seqno}g.className="log"+this.viewStyle+" clog log"+e+(c.toUser?" logPm":"")+(c.infoType?" logInfo":"");if(c.color&&c.color.length>0){g.style.color=c.color}var b=new Array();var a=0;if(c.user){if(!c.infoType){b[a++]='<span style="display:none" id="uname_';b[a++]=c.seqno;b[a++]='">';b[a++]=c.user;b[a++]="</span>"}b[a++]='<span class="logUser';b[a++]=(c.infoType?(" logInfo"+c.infoType):"");b[a++]='">';b[a++]=c.user;b[a++]=(c.toUser?(this.getMsg("msg.c.pmArrow")+c.toUser):"");b[a++]=this.getMsg("msg.c.nameSuffix");b[a++]="</span>"}b[a++]='<span class="logContent"><span class="';b[a++]=(c.toUser?"logMsg logMsgPm":"logMsg");b[a++]='"';if(!this.ignoreFontSize&&c.fontSize&&c.fontSize.length>0){b[a++]=' style="font-size:';b[a++]=c.fontSize;b[a++]='"'}b[a++]=">";if(this.updateTag){b[a++]=wcchatx.processUpdateTag(c.tag)}else{b[a++]=c.tag}b[a++]="</span>";this.buildDataCommon(c,e,b,a,d);g.innerHTML=b.join("");return g}wcchatx.prototype.buildData=_wcchatx_buildData;function _wcchatx_buildIconData(c,e,d){if(c.type=="info"&&(!c.tag||c.tag.length==0)){return}var f=c.type=="info"&&c.infoType=="tweet";if(f){return this.buildTweetData(c,e,d)}var g=document.createElement("div");if(c.eid){g.id="eid_"+c.eid+"_"+c.seqno}else{g.id="inf_"+c.seqno}g.className="log0 clog log"+e+(c.toUser?" logPm":"")+(c.infoType?" logInfo":"");if(c.color&&c.color.length>0){g.style.color=c.color}var b=new Array();var a=0;b[a++]='<div class="logIcon">';if(c.icon){b[a++]='<img class="logUserIcon" alt="" src="';if(this.roomdef.icon){b[a++]=this.roomdef.icon}b[a++]=c.icon;b[a++]='" />'}b[a++]='</div><div class="logContentWrap">';if(c.user){if(!c.infoType){b[a++]='<span style="display:none" id="uname_';b[a++]=c.seqno;b[a++]='">';b[a++]=c.user;b[a++]="</span>"}b[a++]='<span class="logUser';b[a++]=(c.infoType?(" logInfo"+c.infoType):"");b[a++]='">';b[a++]=c.user;b[a++]=(c.toUser?(this.getMsg("msg.c.pmArrow")+c.toUser):"");b[a++]=this.getMsg("msg.c.nameSuffix");b[a++]="</span><br />"}b[a++]='<span class="logContent"><span class="';b[a++]=(c.toUser?"logMsg logMsgPm":"logMsg");b[a++]='"';if(!this.ignoreFontSize&&c.fontSize&&c.fontSize.length>0){b[a++]=' style="font-size:';b[a++]=c.fontSize;b[a++]='"'}b[a++]=">";if(this.updateTag){b[a++]=wcchatx.processUpdateTag(c.tag)}else{b[a++]=c.tag}b[a++]="</span>";this.buildDataCommon(c,e,b,a,d);g.innerHTML=b.join("");return g}wcchatx.prototype.buildIconData=_wcchatx_buildIconData;function _wcchatx_buildDataCommon(e,g,d,c,f){if(e.attach){var b=!this.noThumbnail&&this.conf.enableThumbnail&&WCUtils.startsWith(e.contentType,"image/");var a=this.formatAttachString(this.getMsg("msg.c.attach"),e.contentType,this.sizeString(e.size));d[c++]=' <span class="logAttach"><a class="';d[c++]=b?"logAttachTn":"logAttach";d[c++]='" target="_blank" href="';if(this.roomdef.attach){d[c++]=this.roomdef.attach}else{d[c++]=this.cp}var h=f&&b&&this.order=="asc";d[c++]="/attach/";d[c++]=e.attach;d[c++]='">';if(b){d[c++]='<img class="logAttachTn" alt="';d[c++]=a;if(h){d[c++]='" onload="wcchatx.__scroll(this);'}d[c++]='" src="';if(this.roomdef.attach){d[c++]=this.roomdef.attach}else{d[c++]=this.cp}d[c++]="/tn/";d[c++]=e.attach;d[c++]='" />'}else{d[c++]=a}d[c++]="</a></span>"}if(e.ts||e.userTerm||e.id2ch){d[c++]='<span class="logInfo">(';if(e.ts){d[c++]='<span class="logTs">';d[c++]=e.ts;d[c++]="</span>"}if(e.userTerm){if(e.ts){d[c++]=", "}d[c++]='<span class="logTerm">';d[c++]=e.userTerm;d[c++]="</span>"}if(e.id2ch){if(e.ts||e.userTerm){d[c++]=", "}d[c++]='<span class="logId2ch">';d[c++]=e.id2ch;d[c++]="</span>"}d[c++]=")</span>"}d[c++]='</span></div><div class="logEnd"></div>'}wcchatx.prototype.buildDataCommon=_wcchatx_buildDataCommon;function _wcchatx_getInfo(){var a="ua: "+navigator.userAgent+"\r\nlang: "+navigator.systemLanguage+" "+navigator.browserLanguage+" "+navigator.userLanguage+" "+navigator.language+"\r\nappMinor: "+navigator.appMinorVersion+"\r\n";try{a+="status: "+$GE("status").title+"\r\nprogID: "+this.progId+"\r\nerror: "+this.lastError+"\r\n"}catch(b){}return a}wcchatx.prototype.getInfo=_wcchatx_getInfo;function _wcchatx_keyCheck(a){var b=a?a:window.event;if(b.ctrlKey&&b.keyCode==13){this.send();return false}return true}wcchatx.prototype.keyCheck=_wcchatx_keyCheck;function _wcchatx___scroll(a){setTimeout(function(){var b=$GE("contentWrap");if(b){b.scrollTop=b.scrollHeight}},0);if(a){a.onload=null}}wcchatx.__scroll=_wcchatx___scroll;function _wcchatx_getPlaf(){try{var j=navigator.platform;var a="Unknown";var h=j=="Win32"||j=="Win64";if(window.ActiveXObject){a="ie";if(!h){j="Win"}}else{if(window.opera){a="opera"}else{if(window.dump){a="gecko";if(!h&&navigator.plugins&&navigator.plugins.length>0){for(var c=0;c<navigator.plugins.length;c++){var d=navigator.plugins[c].filename;if(d.length>4){if(d.substring(d.length-4,d.length)){j="Win";break}}}}}else{if(navigator.vendor=="Apple Computer, Inc."){a="safari"}}}}return j+","+a}catch(g){return"err"}}wcchatx.getPlaf=_wcchatx_getPlaf;wcchatx.UT_REGEXP=new RegExp();wcchatx.UT_REGEXP.compile("<a ([^>]*)>https?://([^.]+).youtube.com/watch\\?v=([-a-zA-Z0-9_]+)([^<]*)</a>","g");wcchatx.UT_REGEXP2=new RegExp();wcchatx.UT_REGEXP2.compile("<a ([^>]*)>http://www.nicovideo.jp/watch/(sm[0-9]+)([^<]*)</a>","g");function _wcchatx_processUpdateTag(a){a=a.replace(wcchatx.UT_REGEXP,wcchatx.replFunc);a=a.replace(wcchatx.UT_REGEXP2,wcchatx.replFunc2);return a}wcchatx.processUpdateTag=_wcchatx_processUpdateTag;function _wcchatx_replFunc(e,b,f,c,d){var d="http://www.youtube.com/v/"+encodeURIComponent(c)+"&hl="+(f=="jp"?"ja":"en")+"&fs=1";var a='<object width="425" height="344"><param name="movie" value="'+d+'"></param><param name="allowFullScreen" value="true"></param><param name="wmode" value="transparent"></param><embed wmode="transparent" src="'+d+'" type="application/x-shockwave-flash" allowfullscreen="true" width="425" height="344"></embed></object>';return a}wcchatx.replFunc=_wcchatx_replFunc;function _wcchatx_replFunc2(d,b,c){var f="http://ext.nicovideo.jp/thumb/"+c;var e="http://www.nicovideo.jp/watch/"+c;var a='<iframe width="312" height="176" src="'+f+'" scrolling="no" style="border:solid 1px #CCC;" frameborder="0"><a href="'+e+'">'+encodeURIComponent(e)+"</a></iframe>";return a}wcchatx.replFunc2=_wcchatx_replFunc2;function _wcchatx_refreshAdCB(a){if(a!=null&&a.length>0){var b=$GE("adbody");if(b){b.innerHTML=a}}if(this.adTimeout>0){setTimeout(wcchatx.refreshAd,this.adTimeout*1000)}}wcchatx.prototype.refreshAdCB=_wcchatx_refreshAdCB;function _wcchatx_refreshAd(){var a=$GE("adscr");if(a!=null){a.parentNode.removeChild(a)}a=document.createElement("script");a.id="adscr";a.setAttribute("src","/ad/?dmy="+new Date().getTime());a.setAttribute("type","text/javascript");a.setAttribute("charset","UTF-8");var b=document.getElementsByTagName("head");if(b!=null&&b.length>0){b[0].appendChild(a)}}wcchatx.refreshAd=_wcchatx_refreshAd;function _wcchatx_getTextLog(c,a,d){var f=$GE("content");var b=f.firstChild;var g=this.getMsg("msg.c.textLogSeparator");var e=new Array();var h=0;while(b){var i=b;var k=i.className;if((a||k.indexOf("logInfo")==-1)&&(d||k.indexOf("logPm")==-1)){var j=i.firstChild;if(this.conf.iconmode){if(j.className=="logIcon"){j=j.nextSibling}if(j.className=="logContentWrap"){j=j.firstChild}}var l="";while(j){if(j.id&&WCUtils.startsWith(j.id,"uname_")){j=j.nextSibling;continue}if(WCUtils._ie||window.opera){if(j.innerText){l+=j.innerText+" "}}else{if(j.textContent){l+=j.textContent+" "}}j=j.nextSibling}e[h++]=l+wcchatx.LINE_SEPARATOR;if(g&&g.length>0){e[h++]=g+wcchatx.LINE_SEPARATOR}}b=i.nextSibling}if(this.order!=c){e.reverse()}return e.join("")}wcchatx.prototype.getTextLog=_wcchatx_getTextLog;function _wcchatx_tweet(b){var a=document.getElementById(b);if(!a){a=document.createElement("script");a.id=b;a.src="//platform.twitter.com/widgets.js";document.getElementsByTagName("head")[0].appendChild(a)}else{if(twttr){twttr.widgets.load()}}}wcchatx.prototype.tweet=_wcchatx_tweet;mnt.tid=0;mnt.targ=0;mnt.url="";function mnt(){}function _mnt_start(d,c){var b=20000;var a=(Math.random()*(b*2))-b;mnt.targ=new Date().getTime()+(d*1000)+a;mnt.tid=setInterval(mnt.timerFunc,500);mnt.url=c}mnt.start=_mnt_start;function _mnt_timerFunc(){var a=(mnt.targ-new Date().getTime())/1000;if(a<=0){a=0}var b=$GE("maintenanceSec");if(b){b.innerHTML=parseInt(a)}if(a==0){clearInterval(mnt.tid);mnt.tid=0;top.location.href=mnt.url}}mnt.timerFunc=_mnt_timerFunc;